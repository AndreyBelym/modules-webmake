#!/usr/bin/env node

'use strict';

var count   = require('es5-ext/lib/Object/count')
  , webmake = require('../lib/webmake')

  , now = Date.now

  , optimist = require('optimist')
	.usage("Usage: $0 [options] <input> <output>", {
		sourcemap: {
			boolean: true,
			description: "Include source maps"
		},
		include: {
			description: "Additional modules to require"
		},
		help: {
			boolean: true,
			desription: "Show this help"
		}
	}).demand(2)
  , options = optimist.argv
  , input, output, include;

if (options.help) {
	console.log(optimist.help());
	process.exit(0);
}

input = options._[0];
output = options._[1];

if (options.include) {
	include = options.include;
	if (!Array.isArray(include)) {
		include = [include];
	}
}
var time = now();
webmake(input, { output: output, include: include,
	sourceMap: options.sourcemap }).end(function (parser) {
	time = now() - time;
	console.log("Done [" + parser.modulesFiles.length + " modules from " +
		count(parser.packages) + " packages in " + (time / 1000).toFixed(2) +
		"s]");
	process.exit();
});
